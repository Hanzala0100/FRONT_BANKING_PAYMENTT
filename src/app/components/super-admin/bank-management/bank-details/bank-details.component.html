<div class="p-6" *ngIf="!isLoading; else loadingTemplate">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div class="flex items-center space-x-4">
      <a
        routerLink="/super-admin/banks"
        class="flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors"
      >
        <ion-icon
          name="arrow-back-outline"
          class="text-lg text-gray-600"
        ></ion-icon>
      </a>
      <div>
        <h1 class="text-2xl font-bold text-gray-900">{{ bank?.bankName }}</h1>
        <p class="text-gray-600">Bank Details & Management</p>
      </div>
    </div>

    <div class="flex items-center space-x-3">
      <span
        class="inline-flex px-3 py-1 text-sm font-semibold rounded-full"
        [ngClass]="
          getPerformanceIndicator(
            bank?.totalClients || 0,
            bank?.totalUsers || 0
          ).class
        "
      >
        {{
          getPerformanceIndicator(
            bank?.totalClients || 0,
            bank?.totalUsers || 0
          ).label
        }}
      </span>

      <div class="relative">
        <button
          (click)="refreshData()"
          class="flex items-center px-4 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors"
        >
          <ion-icon name="refresh-outline" class="mr-2"></ion-icon>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div
    *ngIf="errorMessage"
    class="bg-red-50 border border-red-200 rounded-xl p-4 mb-6"
  >
    <div class="flex items-center">
      <ion-icon
        name="alert-circle"
        class="text-red-500 text-lg mr-2"
      ></ion-icon>
      <p class="text-red-700 text-sm font-medium">{{ errorMessage }}</p>
    </div>
  </div>

  <!-- Bank Info Cards -->
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6" *ngIf="bank">
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <div class="flex items-center">
        <div class="bg-blue-100 p-3 rounded-lg">
          <ion-icon
            name="business-outline"
            class="text-blue-600 text-xl"
          ></ion-icon>
        </div>
        <div class="ml-4">
          <p class="text-sm text-gray-600">Bank ID</p>
          <p class="text-2xl font-bold text-gray-900">#{{ bank.bankId }}</p>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <div class="flex items-center">
        <div class="bg-green-100 p-3 rounded-lg">
          <ion-icon
            name="people-outline"
            class="text-green-600 text-xl"
          ></ion-icon>
        </div>
        <div class="ml-4">
          <p class="text-sm text-gray-600">Total Clients</p>
          <p class="text-2xl font-bold text-gray-900">
            {{ bank.totalClients }}
          </p>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <div class="flex items-center">
        <div class="bg-purple-100 p-3 rounded-lg">
          <ion-icon
            name="person-outline"
            class="text-purple-600 text-xl"
          ></ion-icon>
        </div>
        <div class="ml-4">
          <p class="text-sm text-gray-600">Total Users</p>
          <p class="text-2xl font-bold text-gray-900">{{ bank.totalUsers }}</p>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <div class="flex items-center">
        <div class="bg-orange-100 p-3 rounded-lg">
          <ion-icon
            name="person-circle-outline"
            class="text-orange-600 text-xl"
          ></ion-icon>
        </div>
        <div class="ml-4">
          <p class="text-sm text-gray-600">Admin</p>
          <p class="text-sm font-medium text-gray-900">
            {{ bank.adminUsername }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 mb-6">
    <div class="border-b border-gray-200">
      <nav class="flex space-x-8 px-6">
        <button
          *ngFor="let tab of tabs"
          (click)="activeTab = tab.id"
          class="py-4 px-1 border-b-2 font-medium text-sm transition-colors"
          [class.border-blue-500]="activeTab === tab.id"
          [class.text-blue-600]="activeTab === tab.id"
          [class.border-transparent]="activeTab !== tab.id"
          [class.text-gray-500]="activeTab !== tab.id"
          [class.hover:text-gray-700]="activeTab !== tab.id"
        >
          <ion-icon [name]="tab.icon" class="mr-2"></ion-icon>
          {{ tab.label }}
        </button>
      </nav>
    </div>

    <!-- Tab Content -->
    <div class="p-6">
      <!-- Overview Tab -->
      <div *ngIf="activeTab === 'overview'" class="space-y-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Bank Information -->
          <div class="space-y-4">
            <h3 class="text-lg font-semibold text-gray-900 flex items-center">
              <ion-icon
                name="business-outline"
                class="mr-2 text-blue-600"
              ></ion-icon>
              Bank Information
            </h3>

            <div class="space-y-3">
              <div class="flex justify-between py-2 border-b border-gray-100">
                <span class="text-gray-600">Bank Name:</span>
                <span class="font-medium text-gray-900">{{
                  bank?.bankName
                }}</span>
              </div>
              <div class="flex justify-between py-2 border-b border-gray-100">
                <span class="text-gray-600">Bank ID:</span>
                <span class="font-medium text-gray-900"
                  >#{{ bank?.bankId }}</span
                >
              </div>
              <div class="flex justify-between py-2">
                <span class="text-gray-600">Address:</span>
                <span class="font-medium text-gray-900 text-right max-w-xs">{{
                  bank?.address
                }}</span>
              </div>
            </div>
          </div>

          <!-- Contact Information -->
          <div class="space-y-4">
            <h3 class="text-lg font-semibold text-gray-900 flex items-center">
              <ion-icon
                name="mail-outline"
                class="mr-2 text-green-600"
              ></ion-icon>
              Contact Information
            </h3>

            <div class="space-y-3">
              <div class="flex justify-between py-2 border-b border-gray-100">
                <span class="text-gray-600">Email:</span>
                <span class="font-medium text-gray-900">{{
                  bank?.contactEmail
                }}</span>
              </div>
              <div class="flex justify-between py-2 border-b border-gray-100">
                <span class="text-gray-600">Phone:</span>
                <span class="font-medium text-gray-900">{{
                  bank?.contactPhone
                }}</span>
              </div>
              <div class="flex justify-between py-2">
                <span class="text-gray-600">Admin Username:</span>
                <span class="font-medium text-gray-900">{{
                  bank?.adminUsername
                }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Performance Metrics -->
        <div class="bg-gray-50 rounded-xl p-6">
          <h3
            class="text-lg font-semibold text-gray-900 mb-4 flex items-center"
          >
            <ion-icon
              name="analytics-outline"
              class="mr-2 text-purple-600"
            ></ion-icon>
            Performance Metrics
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="text-center p-4 bg-white rounded-lg">
              <p class="text-2xl font-bold text-gray-900">
                {{ bank?.totalClients }}
              </p>
              <p class="text-sm text-gray-600">Total Clients</p>
            </div>
            <div class="text-center p-4 bg-white rounded-lg">
              <p class="text-2xl font-bold text-gray-900">
                {{ bank?.totalUsers }}
              </p>
              <p class="text-sm text-gray-600">Total Users</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Clients Tab -->
      <div *ngIf="activeTab === 'clients'">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-semibold text-gray-900">Bank Clients</h3>
          <span class="text-sm text-gray-500"
            >{{ bank?.totalClients }} clients registered</span
          >
        </div>

        <div class="text-center py-12">
          <ion-icon
            name="people-outline"
            class="text-6xl text-gray-300 mb-4"
          ></ion-icon>
          <h3 class="text-lg font-medium text-gray-900 mb-2">
            Client Management
          </h3>
          <p class="text-gray-500 mb-6">
            Client management is handled by the bank administrator. Super Admin
            can view overall statistics but not individual client details.
          </p>
          <div class="text-sm text-gray-600">
            <p>
              Total Clients: <strong>{{ bank?.totalClients }}</strong>
            </p>
            <p class="mt-1">
              Client management access: Bank Administrator only
            </p>
          </div>
        </div>
      </div>

      <!-- Users Tab -->
      <div *ngIf="activeTab === 'users'">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-semibold text-gray-900">Bank Users</h3>
          <span class="text-sm text-gray-500"
            >{{ bank?.totalUsers }} users registered</span
          >
        </div>

        <div class="text-center py-12">
          <ion-icon
            name="person-outline"
            class="text-6xl text-gray-300 mb-4"
          ></ion-icon>
          <h3 class="text-lg font-medium text-gray-900 mb-2">
            User Management
          </h3>
          <p class="text-gray-500 mb-6">
            User management is handled by the bank administrator. Super Admin
            can view overall user statistics but not individual user details.
          </p>
          <div class="text-sm text-gray-600">
            <p>
              Total Users: <strong>{{ bank?.totalUsers }}</strong>
            </p>
            <p class="mt-1">User management access: Bank Administrator only</p>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div *ngIf="activeTab === 'settings'">
        <div class="space-y-6">
          <div>
            <h3
              class="text-lg font-semibold text-gray-900 mb-4 flex items-center"
            >
              <ion-icon
                name="settings-outline"
                class="mr-2 text-orange-600"
              ></ion-icon>
              Bank Settings
            </h3>
            <p class="text-gray-600 mb-6">
              Manage bank settings and administrative actions.
            </p>
          </div>

          <!-- Danger Zone -->
          <div class="border border-red-200 rounded-xl bg-red-50 p-6">
            <h4
              class="text-lg font-semibold text-red-900 mb-2 flex items-center"
            >
              <ion-icon name="warning-outline" class="mr-2"></ion-icon>
              Danger Zone
            </h4>
            <p class="text-red-700 mb-4">
              Deleting this bank will permanently remove all associated data
              including clients, users, and transaction history. This action
              cannot be undone.
            </p>
            <button
              (click)="deleteBank()"
              class="flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors"
            >
              <ion-icon name="trash-outline" class="mr-2"></ion-icon>
              Delete Bank
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading Template -->
<ng-template #loadingTemplate>
  <div class="p-6">
    <div class="text-center py-12">
      <div
        class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
      ></div>
      <p class="text-gray-500 mt-2">Loading bank details...</p>
    </div>
  </div>
</ng-template>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteModal" class="fixed inset-0 z-50 overflow-y-auto">
  <div
    class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
  >
    <div class="fixed inset-0 transition-opacity" (click)="closeDeleteModal()">
      <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
    </div>

    <div
      class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
    >
      <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <div class="sm:flex sm:items-start">
          <div
            class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"
          >
            <ion-icon
              name="alert-circle-outline"
              class="text-red-600 text-xl"
            ></ion-icon>
          </div>
          <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
            <h3 class="text-lg leading-6 font-medium text-gray-900">
              Delete Bank
            </h3>
            <div class="mt-2">
              <p class="text-sm text-gray-500">
                Are you sure you want to delete
                <strong>{{ bank?.bankName }}</strong
                >? This action cannot be undone and will remove all associated
                data including:
              </p>
              <ul class="text-sm text-gray-500 mt-2 list-disc list-inside">
                <li>{{ bank?.totalClients }} client companies</li>
                <li>{{ bank?.totalUsers }} user accounts</li>
                <li>All transaction history</li>
                <li>All reports and documents</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
        <button
          (click)="confirmDelete()"
          [disabled]="isDeletingBank"
          class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50"
        >
          <span *ngIf="isDeletingBank" class="mr-2">
            <div
              class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"
            ></div>
          </span>
          {{ isDeletingBank ? "Deleting..." : "Delete Bank" }}
        </button>
        <button
          (click)="closeDeleteModal()"
          class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
        >
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>
