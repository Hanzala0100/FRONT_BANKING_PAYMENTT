<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <nav class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center space-x-4">
          <div
            class="h-10 w-10 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg"
          >
            <ion-icon name="stats-chart" class="text-white text-xl"></ion-icon>
          </div>
          <div>
            <h1 class="text-xl font-bold text-gray-900">Dashboard</h1>
            <p class="text-sm text-gray-500">Voucher Management System</p>
          </div>
        </div>
        <div class="flex items-center space-x-3">
          <button
            (click)="goToRedeem()"
            class="inline-flex items-center space-x-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-indigo-600 transition-all duration-200 shadow-sm"
          >
            <ion-icon name="ticket" class="text-lg"></ion-icon>
            <span>Redeem Voucher</span>
          </button>
          <button
            (click)="logout()"
            class="inline-flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-red-500 rounded-lg hover:bg-red-600 transition-all duration-200 shadow-sm"
          >
            <ion-icon name="log-out" class="text-lg"></ion-icon>
            <span>Logout</span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex items-center justify-center py-12">
      <div class="text-center">
        <div
          class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"
        ></div>
        <p class="mt-4 text-gray-600">Loading dashboard data...</p>
      </div>
    </div>

    <!-- Error State -->
    <div
      *ngIf="error && !isLoading"
      class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8"
    >
      <div class="flex items-center">
        <ion-icon
          name="alert-circle"
          class="text-red-500 text-xl mr-3"
        ></ion-icon>
        <div>
          <h3 class="text-red-800 font-medium">Error Loading Data</h3>
          <p class="text-red-600 text-sm mt-1">{{ error }}</p>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div
      class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"
      *ngIf="voucherStats && !isLoading"
    >
      <!-- Total Vouchers -->
      <div
        class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow duration-200"
      >
        <div class="p-6">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <div
                class="h-14 w-14 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-sm"
              >
                <ion-icon name="albums" class="text-2xl text-white"></ion-icon>
              </div>
            </div>
            <div class="ml-4 flex-1">
              <div
                class="text-sm font-medium text-gray-500 uppercase tracking-wide"
              >
                Total Vouchers
              </div>
              <div class="text-3xl font-bold text-gray-900 mt-1">
                {{ voucherStats.totalVouchers | number }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Available Vouchers -->
      <div
        class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow duration-200"
      >
        <div class="p-6">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <div
                class="h-14 w-14 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center shadow-sm"
              >
                <ion-icon
                  name="checkmark-circle"
                  class="text-2xl text-white"
                ></ion-icon>
              </div>
            </div>
            <div class="ml-4 flex-1">
              <div
                class="text-sm font-medium text-gray-500 uppercase tracking-wide"
              >
                Available
              </div>
              <div class="text-3xl font-bold text-gray-900 mt-1">
                {{ voucherStats.totalAvailableVouchers | number }}
              </div>
              <div class="text-sm text-emerald-600 font-medium mt-1">
                {{
                  getPercentage(
                    voucherStats.totalAvailableVouchers,
                    voucherStats.totalVouchers
                  )
                }}% remaining
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Redeemed Vouchers -->
      <div
        class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow duration-200"
      >
        <div class="p-6">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <div
                class="h-14 w-14 bg-gradient-to-r from-orange-500 to-amber-600 rounded-xl flex items-center justify-center shadow-sm"
              >
                <ion-icon name="gift" class="text-2xl text-white"></ion-icon>
              </div>
            </div>
            <div class="ml-4 flex-1">
              <div
                class="text-sm font-medium text-gray-500 uppercase tracking-wide"
              >
                Redeemed
              </div>
              <div class="text-3xl font-bold text-gray-900 mt-1">
                {{ voucherStats.totalRedemeedVouchers | number }}
              </div>
              <div class="text-sm text-amber-600 font-medium mt-1">
                {{
                  getPercentage(
                    voucherStats.totalRedemeedVouchers,
                    voucherStats.totalVouchers
                  )
                }}% used
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Progress Bar -->
    <div
      class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden mb-8"
      *ngIf="voucherStats && !isLoading"
    >
      <div class="p-6">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold text-gray-900 flex items-center">
            <ion-icon
              name="bar-chart"
              class="mr-3 text-indigo-600 text-2xl"
            ></ion-icon>
            Redemption Progress
          </h3>
          <div class="text-right">
            <div class="text-sm font-medium text-gray-900">
              {{ voucherStats.totalRedemeedVouchers | number }} of
              {{ voucherStats.totalVouchers | number }}
            </div>
            <div class="text-xs text-gray-500">vouchers redeemed</div>
          </div>
        </div>

        <div class="relative">
          <div class="w-full bg-gray-200 rounded-full h-6 overflow-hidden">
            <div
              class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 h-6 rounded-full transition-all duration-1000 ease-out relative"
              [style.width.%]="
                getPercentage(
                  voucherStats.totalRedemeedVouchers,
                  voucherStats.totalVouchers
                )
              "
            >
              <div
                class="absolute inset-0 bg-white bg-opacity-20 animate-pulse"
              ></div>
            </div>
          </div>
          <div
            class="flex justify-between text-xs font-medium text-gray-600 mt-3"
          >
            <span>0%</span>
            <span class="bg-gray-100 px-2 py-1 rounded-full">
              {{
                getPercentage(
                  voucherStats.totalRedemeedVouchers,
                  voucherStats.totalVouchers
                )
              }}%
            </span>
            <span>100%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Outlet Breakdown -->
    <div
      class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"
      *ngIf="outletData && !isLoading"
    >
      <div
        class="px-6 py-5 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white"
      >
        <h3 class="text-xl font-semibold text-gray-900 flex items-center">
          <ion-icon
            name="storefront"
            class="mr-3 text-indigo-600 text-2xl"
          ></ion-icon>
          Redemptions by Outlet
        </h3>
        <p class="text-sm text-gray-600 mt-1">
          Track performance across all outlets
        </p>
      </div>

      <div class="p-6">
        <div
          class="grid grid-cols-1 lg:grid-cols-2 gap-4"
          *ngIf="getOutletArray().length > 0; else noOutletData"
        >
          <div
            *ngFor="let outlet of getOutletArray(); trackBy: trackByOutletId"
            class="group relative bg-gradient-to-r from-gray-50 to-white border border-gray-200 rounded-xl p-5 hover:shadow-md hover:border-indigo-200 transition-all duration-200"
          >
            <div class="flex items-center justify-between">
              <div class="flex items-center flex-1 min-w-0">
                <div
                  class="h-12 w-12 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center mr-4 shadow-sm group-hover:scale-105 transition-transform duration-200"
                >
                  <ion-icon
                    name="location"
                    class="text-white text-xl"
                  ></ion-icon>
                </div>
                <div class="flex-1 min-w-0">
                  <div
                    class="font-semibold text-gray-900 truncate"
                    [title]="outlet.name"
                  >
                    {{ outlet.name }}
                  </div>
                  <div class="text-sm text-gray-600 mt-1">
                    <ion-icon name="pin" class="text-xs mr-1"></ion-icon>
                    {{ outlet.pincode }}
                  </div>
                  <div class="text-xs text-gray-500 mt-1">
                    {{ outlet.successful_redeems }} successful redemptions
                  </div>
                </div>
              </div>
              <div class="text-right ml-4">
                <div class="text-2xl font-bold text-indigo-600">
                  {{ outlet.successful_redeems | number }}
                </div>
                <div class="text-xs text-gray-500">redeems</div>
              </div>
            </div>
          </div>
        </div>

        <ng-template #noOutletData>
          <div class="text-center py-8">
            <ion-icon
              name="storefront-outline"
              class="text-4xl text-gray-400 mb-3"
            ></ion-icon>
            <p class="text-gray-500">No outlet data available</p>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Last Updated -->
    <div class="mt-8 text-center">
      <div
        class="inline-flex items-center px-4 py-2 bg-white border border-gray-200 rounded-full shadow-sm"
      >
        <ion-icon
          name="sync"
          class="mr-2 text-indigo-600 text-sm"
          [class.animate-spin]="isLoading"
        ></ion-icon>
        <span class="text-sm text-gray-600">
          Last updated: {{ lastUpdated | date : "short" }}
        </span>
        <span class="mx-2 text-gray-400">â€¢</span>
        <span class="text-xs text-gray-500">Auto-refresh every 30 seconds</span>
      </div>
    </div>
  </div>
</div>
